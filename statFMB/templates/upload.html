<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Estatísticas FMB</title>

    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
      <div class="container">
          <div class="page-header text-center">
              <h1>Relatório de carregamento<small></small></h1>
          </div>
          {% if upload_results %}
          <h3>Correções necessárias:</h3>
          <div class="row">
              <div class ="panel-group">

                  <form method="POST" action="/upload/finalize">
                  {% for result in upload_results %}
                  <div class="panel panel-info">
                      <div class="panel-heading">
                          <div class="row">
                              <div class="col-md-6">
                                  <h3 class="panel-title">
                                      Ficheiro: {{ result }}
                                  </h3>
                              </div>
                              <div class="col-md-3">
                                  <h3 class="panel-title">
                                      Registos efetuados:
                                      {{ upload_results[result][1]|length }}
                                  </h3>
                              </div>
                              <div class="col-md-3">
                                  <h3 class="panel-title">
                                      Registos falhados:
                                      {{ upload_results[result][2]|length }}
                                  </h3>
                              </div>
                          </div>
                      </div>
                      {% for invalid_entry in upload_results[result][2] %}
                      <div class="panel-body">

                          <div class="form-group">
                              <label  class="col-md-2 control-label" for="vt">
                                  <h5>Viatura lida:
                                      <b>{{ invalid_entry[0] }}</b>
                                  </h5>
                              </label>

                              <div class="col-md-2">
                                  {% for vt in vt_list
                                  if vt == invalid_entry[0] %}

                                  <select class="form-control" id="vt"
                                          name="vt"
                                          disabled>
                                      <option selected="selected"
                                              value={{ vt }}>
                                          {{ vt }}
                                      </option>
                                  </select>
                                  <input type="hidden" name="vt"
                                         value={{ vt }} />

                                  {% else %}

                                  <select class="form-control" id="vt"
                                          name="vt"
                                          required>
                                      <option disabled selected value>
                                          CORRIGIR
                                      </option>
                                      {% for vt in vt_list %}
                                      <option value={{ vt }}>
                                          {{ vt }}
                                      </option>
                                      {% endfor%}
                                  </select>
                                  {% endfor %}
                              </div>
                              <input type="hidden" name="p"
                                     value={{ invalid_entry[1] }} />

                          </div>


                          <div class="form-group">
                              <label  class="col-md-2 control-label" for="c">
                                  <h5>País lido:
                                      <b>{{ invalid_entry[2] }}</b>
                                  </h5>
                              </label>
                              <div class="col-md-2">
                                  {% for c in c_list
                                  if c == invalid_entry[2]
                                  and invalid_entry[2] != "N/A" %}
                                  <select class="form-control" id="c" name="c"
                                          disabled>
                                      <option selected="selected"
                                              value={{ c }}>
                                          {{ c }}
                                      </option>
                                  </select>
                                  <input type="hidden" name="c"
                                         value={{ c }} />
                                  {% else %}
                                  <select class="form-control" id="c" name="c"
                                          required>

                                      {% if invalid_entry[2] != "N/A" %}
                                      <option disabled selected value>
                                          CORRIGIR
                                      </option>
                                      {% else %}
                                      <option disabled selected value>
                                          N/A
                                      </option>
                                      {% endif %}

                                      {% for c in c_list %}
                                      <option value={{ c }}>
                                          {{ c }}
                                      </option>
                                      {% endfor%}
                                  </select>
                                  {% endfor %}
                              </div>
                          </div>


                          <div class="form-group">
                              <label  class="col-md-2 control-label" for="m">
                                  <h5>Concelho lido:
                                      <b>{{ invalid_entry[3] }}</b>
                                  </h5>
                              </label>
                              <div class="col-md-2">
                                  {% for m in m_list
                                  if m == invalid_entry[3]
                                  and invalid_entry[3] != "N/A" %}
                                  <select class="form-control" id="m" name="m"
                                          disabled>
                                      <option selected="selected"
                                              value={{ m }}>
                                          {{ m }}
                                      </option>
                                  </select>
                                  <input type="hidden" name="m"
                                         value={{ m }} />
                                  {% else %}
                                  <select class="form-control" id="m" name="m"
                                          required>

                                      {% if invalid_entry[3] != "N/A" %}
                                      <option disabled selected value>
                                          CORRIGIR
                                      </option>
                                      {% else %}
                                      <option disabled selected value>
                                          N/A
                                      </option>
                                      {% endif %}

                                      {% for m in m_list %}
                                      <option value={{ m }}>
                                          {{ m }}
                                      </option>
                                      {% endfor%}
                                  </select>
                                  {% endfor %}
                              </div>
                          </div>


                      </div>
                      {% endfor %}
                      <input type="hidden" name="r"
                             value = {{ upload_results[result][0].id }} />
                      <input type="hidden" name="r"
                             value = {{ upload_results[result][1]|length }} />

                  </div>
                  {% endfor %}
                  <hr>
                  <div class="row">
                      <div class="col-md-3">
                          <button type="submit" class="btn btn-default
                                                       btn-lg btn-block">
                              <span class="glyphicon glyphicon-floppy-remove"
                                    aria-hidden="true"></span>
                              Esquecer
                          </button>
                      </div>
                      <div class="col-md-9">
                          <button type="submit" class="btn btn-primary
                                                       btn-lg btn-block">
                              <span class="glyphicon glyphicon-floppy-disk"
                                    aria-hidden="true"></span>
                              Guardar
                          </button>
                      </div>
                  </div>
                  </form>
              </div>
              </div>
          {% endif %}
      </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>
  </body>
</html>
