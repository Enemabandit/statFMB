{% extends "layout.html" %}
{% from "macros.html" import search_form %}

{% block title %}Gráficos{% endblock %}

{% block head %}
{{ super() }}

<!-- TODO:this should be working from a local file -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="/static/js/charts.js"></script>
{% endblock %}

{% block body%}

<div class ="container">
    <!-- Page Title -->
    <div class="page-header">
        <br>
        <h1>Gráficos   <small>Fundação Mata do Bussaco</small></h1>
    </div>

    <!-- search_form -->
    {{ search_form("/charts",lower_date,upper_date,date_warning) }}

    {% if search %}
    <br>
    <!-- chart_form -->
    <div class="col-md-3">
        <h4><b>Detalhes da Pesquisa</b></h4>
        <h4><b>Porta:</b> {{ gate }}</h4>
        <h4><b>Período:</b> {{ period_str }}</h4>
        <h4><b>Resultados de:</b></h4>
        <h4>{{ lower_date }} <b>a</b> {{ upper_date }}</h4>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs nav-justified">
                        <li class="active">
                            <a href="#maps" role="tab" data-toggle="tab"
                               class="text-success">
                                <b>Mapa</b>
                            </a>
                        </li>
                        <li>
                            <a href="#pie" role="tab" data-toggle="tab"
                               class="text-success">
                                <b>Circular</b>
                            </a>
                        </li>
                        <li>
                            <a href="#line" role="tab" data-toggle="tab"
                               class="text-success">
                                <b>Cartesiano</b>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="panel-body">
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div class="tab-pane active" id="maps">
                            <h4> Visualizar no mapa: </h4>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio" name="optionsRadios"
                                           id="maps-world" value="option2">
                                    Mundo
                                </label>
                            </div>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio" name="optionsRadios"
                                           id="maps-europe" value="option2">
                                    Europa
                                </label>
                            </div>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio" name="optionsRadios"
                                           id="maps-portugal" value="option2">
                                    Portugal
                                </label>
                            </div>
                            <button class="btn btn-success" id="map-btn"
                                    href="#"
                                    type="button"
                                    style="float: right;">
                                <span class="glyphicon glyphicon-share-alt"
                                      aria-hidden="true"></span>
                                Gerar
                            </button>
                        </div>

                        <div class="tab-pane" id="pie">
                            <h4>Sumatórios de entradas:</h4>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio" name="optionsRadios"
                                           id="pie-gates" value="option2">
                                    Portas
                                </label>
                            </div>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio" name="optionsRadios"
                                           id="pie-countries" value="option2">
                                    Paises
                                    </label>
                            </div>
                            <div class="form-group col-md-3">
                                <label>
                                    <input type="radio"
                                           name="optionsRadios"
                                           id="pie-municipalities"
                                           value="option2">
                                    Concelhos
                                    </label>
                            </div>
                            <button class="btn btn-success" id="pie-btn"
                                    href="#"
                                    type="button"
                                    style="float: right;">
                                <span class="glyphicon glyphicon-share-alt"
                                      aria-hidden="true"></span>
                                Gerar
                            </button>
                        </div>

                        <div class="tab-pane" id="line">
                            <button class="btn btn-success" id="line-btn"
                                    href="#"
                                    type="button"
                                    style="float: right;">
                                <span class="glyphicon glyphicon-share-alt"
                                      aria-hidden="true"></span>
                                Gerar
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- warnings for the chart form -->
        <div class="alert alert-danger" id="error-div" role="alert"
             style="display: none">
             <span class="glyphicon glyphicon-exclamation-sign"
                  aria-hidden="true">
            </span>
            <b>Erro,</b>
            <p id="error-message" style="display: inline">
            </p>
        </div>
    </div>

    <!-- chart renderer -->
    <div class="row">
        <div class="col-md-12">
            <div id="chart-container">
            </div>
        </div>
    </div>
</div>
{% else %}

<!-- default image before search -->
<br>
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center">
            <img src="/static/img/logo.png" height="200px"
                 alt="logo here"></img>
        </div>
    </div>
</div>
<br>
{% endif %}


<script>
 $(function(){
     document.getElementById("map-btn").addEventListener('click',function(){
         clearError();
         clearChart();
         generateMap().renderTo("chart-container");
     });

     document.getElementById("pie-btn").addEventListener('click',function(){
         clearError();
         clearChart();
         generatePie().renderTo("chart-container");
     });

     document.getElementById("line-btn").addEventListener('click',function(){
         clearError();
         clearChart();
         generateLine().renderTo("chart-container");
     });
 });
</script>




<script>
Highcharts.chart('chart-container', {

    title: {
        text: 'Tipos de Veículos'
    },

    subtitle: {
        text: 'Periodo: {{ period_str }}'
    },

    yAxis: {
        title: {
            text: 'Numero de entradas'
        }
    },

    xAxis: {
        //TODO: place period.designation here
        categories: ['aa','bb']
    },

    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle'
    },

    plotOptions: {
        series: {
            pointStart: 0
        }
    },

    series: [{
        name: 'Moto',
        data: []
    }, {
        name: 'Ligeiro',
        data: [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434]
    }, {
        name: 'Ligeiro XL',
        data: [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387]
    }, {
        name: 'Caravana',
        data: [null, null, 7988, 12169, 15112, 22452, 34400, 34227]
    }, {
        name: 'Autocarro',
        data: [12908, 5948, 8105, 11248, 8989, 11816, 18274, 18111]
    }]

});
</script>


{% endblock %}
